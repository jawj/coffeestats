/*
Copyright (c) 2007-2010 the OTHER media Limited
Licensed under the BSD license, http://ojay.othermedia.org/license.html
Version: 0.4-5e330a3f7a5662d723dcf511ec3d5ed078d67be1
Build:   min
*/

Ojay.Accordion=new JS.Class('Ojay.Accordion',{include:[Ojay.Observable,JS.State],extend:{DIRECTIONS:{horizontal:'HorizontalSection',vertical:'VerticalSection'}},initialize:function(a,b,c,d){this._8=d||{};this._9=a;this._3=b;this._a=c;this.setState('CREATED')},getInitialState:function(){return{section:0}},getSections:function(){return this._3?this._3.slice():[]},states:{CREATED:{setup:function(){var c=this.klass[this.klass.DIRECTIONS[this._9]];this._3=Ojay(this._3).map(function(a,b){a=new c(this,b,a,this._a,this._8);a.on('expand')._(this).notifyObservers('sectionexpand',b,a);a.on('collapse')._(this).notifyObservers('sectioncollapse',b,a);return a},this);this.setState('READY');return this.changeState(this.getInitialState(),false)}},READY:{changeState:function(b,c){var d=this._3[b.section];if(!d||d===this._4)return this;this.setState('ANIMATING');if(this._4)this._4.collapse(c);d.expand(c)._(function(a){a._4=d;a.setState('READY')},this);return this},expand:function(a,b){this.changeState({section:a},b);return this},collapse:function(a,b){var c=this._3[a];if(c)c.collapse(b);if(c===this._4)this._4=null;return this}},ANIMATING:{}}});Ojay.Accordion.extend({Section:new JS.Class('Ojay.Accordion.Section',{include:Ojay.Observable,extend:{SECTION_CLASS:'accordion-section',COLLAPSER_CLASS:'accordion-collapsible',DEFAULT_EVENT:'click',DEFAULT_DURATION:0.4,DEFAULT_EASING:'easeBoth'},initialize:function(a,b,c,d,e){this._5=a;this._2=c;var f=c.descendants(d).at(0);this._0=Ojay(Ojay.HTML.div({className:this.klass.COLLAPSER_CLASS}));f.insert(this._0,'before');this._0.insert(f);this._2.insert(this._0,'after');this._0.setStyle({position:'relative',zoom:1});e=e||{};this._6=e.duration||this.klass.DEFAULT_DURATION;this._7=e.easing||this.klass.DEFAULT_EASING;this._2.addClass(this.klass.SECTION_CLASS);this._2.on(e.event||this.klass.DEFAULT_EVENT)._(this._5).changeState({section:b});if(e.collapseOnClick){this._2.on('click')._(this._5).collapse(b)}this._1=true;this.collapse(false)},getContainer:function(){return this._2},getCollapser:function(){return this._0},collapse:function(b){if(!this._1)return this;this._0.setStyle({overflow:'hidden'});this._2.removeClass('expanded').addClass('collapsed');var c={};c[this.param]=(b===false)?0:{to:0};if(b!==false)this.notifyObservers('collapse');if(b===false){this._0.setStyle(c).setStyle({overflow:'hidden'});this._1=false;return this}else{return this._0.animate(c,this._6,{easing:this._7}).setStyle({overflow:'hidden'})._(function(a){a._1=false},this)._(this)}},expand:function(b){if(this._1)return this;this._0.setStyle({overflow:'hidden'});this._2.addClass('expanded').removeClass('collapsed');var c=this.getSize(),d={},e={overflow:''};d[this.param]=(b===false)?'':{to:c};e[this.param]='';if(b!==false)this.notifyObservers('expand');if(b===false){this._0.setStyle(d).setStyle({overflow:''});this._1=true;return this}else{return this._0.animate(d,this._6,{easing:this._7}).setStyle(e)._(function(a){a._1=true},this)._(this)}}})});Ojay.Accordion.extend({HorizontalSection:new JS.Class('Ojay.Accordion.HorizontalSection',Ojay.Accordion.Section,{param:'width',getSize:function(){var d=this._5.getSections();var e=d.map(function(a){var b=a._0,c=b.getRegion().getWidth();b.setStyle({width:a==this?'':0});return c},this);var f=this._0.getRegion().getWidth();d.forEach(function(a,b){a._0.setStyle({width:e[b]+'px'})});return f}}),VerticalSection:new JS.Class('Ojay.Accordion.VerticalSection',Ojay.Accordion.Section,{param:'height',getSize:function(){if(!this._1)this._0.setStyle({height:''});var a=this._0.getRegion().getHeight();if(!this._1)this._0.setStyle({height:0});return a}})});